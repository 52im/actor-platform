//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/actor-ios/build/java/im/actor/model/droidkit/engine/AsyncListEngine.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/droidkit/bser/BserCreator.h"
#include "im/actor/model/droidkit/bser/BserObject.h"
#include "im/actor/model/droidkit/engine/AsyncListEngine.h"
#include "im/actor/model/droidkit/engine/AsyncStorageInt.h"
#include "im/actor/model/droidkit/engine/ListEngineCallback.h"
#include "im/actor/model/droidkit/engine/ListEngineDisplayListener.h"
#include "im/actor/model/droidkit/engine/ListEngineItem.h"
#include "im/actor/model/droidkit/engine/ListStorage.h"
#include "im/actor/model/droidkit/engine/ObjectCache.h"
#include "java/lang/Long.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "java/util/concurrent/CopyOnWriteArrayList.h"

__attribute__((unused)) static id<ImActorModelDroidkitEngineListEngineCallback> ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(ImActorModelDroidkitEngineAsyncListEngine *self, id<ImActorModelDroidkitEngineListEngineCallback> callback);

@interface ImActorModelDroidkitEngineAsyncListEngine () {
 @public
  ImActorModelDroidkitEngineAsyncStorageInt *asyncStorageInt_;
  ImActorModelDroidkitEngineObjectCache *cache_;
  id LOCK_;
  JavaUtilConcurrentCopyOnWriteArrayList *listeners_;
}

- (id<ImActorModelDroidkitEngineListEngineCallback>)coverWithImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback;
@end

J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine, asyncStorageInt_, ImActorModelDroidkitEngineAsyncStorageInt *)
J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine, cache_, ImActorModelDroidkitEngineObjectCache *)
J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine, LOCK_, id)
J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine, listeners_, JavaUtilConcurrentCopyOnWriteArrayList *)

@interface ImActorModelDroidkitEngineAsyncListEngine_$1 () {
 @public
  ImActorModelDroidkitEngineAsyncListEngine *this$0_;
  id<ImActorModelDroidkitEngineListEngineCallback> val$callback_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine_$1, this$0_, ImActorModelDroidkitEngineAsyncListEngine *)
J2OBJC_FIELD_SETTER(ImActorModelDroidkitEngineAsyncListEngine_$1, val$callback_, id<ImActorModelDroidkitEngineListEngineCallback>)

@implementation ImActorModelDroidkitEngineAsyncListEngine

- (instancetype)initWithImActorModelDroidkitEngineListStorage:(id<ImActorModelDroidkitEngineListStorage>)storage
                                            withBSBserCreator:(id<BSBserCreator>)creator {
  if (self = [super init]) {
    cache_ = [[ImActorModelDroidkitEngineObjectCache alloc] init];
    LOCK_ = [[NSObject alloc] init];
    listeners_ = [[JavaUtilConcurrentCopyOnWriteArrayList alloc] init];
    self->asyncStorageInt_ = [[ImActorModelDroidkitEngineAsyncStorageInt alloc] initWithImActorModelDroidkitEngineListStorage:storage withBSBserCreator:creator];
  }
  return self;
}

- (void)addOrUpdateItemWithBSBserObject:(BSBserObject<ImActorModelDroidkitEngineListEngineItem> *)item {
  @synchronized(LOCK_) {
    [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<ImActorModelDroidkitEngineListEngineItem> *) nil_chk(item)) getEngineId]) withId:item];
    id<JavaUtilList> items = [[JavaUtilArrayList alloc] init];
    [items addWithId:item];
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) addOrUpdateItemsWithJavaUtilList:items];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) addOrUpdateWithId:item];
    }
  }
}

- (void)addOrUpdateItemsWithJavaUtilList:(id<JavaUtilList>)items {
  @synchronized(LOCK_) {
    for (BSBserObject<ImActorModelDroidkitEngineListEngineItem> * __strong i in nil_chk(items)) {
      [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<ImActorModelDroidkitEngineListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) addOrUpdateItemsWithJavaUtilList:items];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) addOrUpdateWithJavaUtilList:items];
    }
  }
}

- (void)replaceItemsWithJavaUtilList:(id<JavaUtilList>)items {
  @synchronized(LOCK_) {
    [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) clear];
    for (BSBserObject<ImActorModelDroidkitEngineListEngineItem> * __strong i in nil_chk(items)) {
      [cache_ onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<ImActorModelDroidkitEngineListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) replaceItemsWithJavaUtilList:items];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) onItemsReplacedWithJavaUtilList:items];
    }
  }
}

- (void)removeItemWithLong:(jlong)key {
  @synchronized(LOCK_) {
    [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) removeObjectWithId:JavaLangLong_valueOfWithLong_(key)];
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) removeWithLongArray:[IOSLongArray newArrayWithLongs:(jlong[]){ key } count:1]];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) onItemRemovedWithLong:key];
    }
  }
}

- (void)removeItemsWithLongArray:(IOSLongArray *)keys {
  @synchronized(LOCK_) {
    {
      IOSLongArray *a__ = keys;
      jlong const *b__ = ((IOSLongArray *) nil_chk(a__))->buffer_;
      jlong const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        jlong key = *b__++;
        [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) removeObjectWithId:JavaLangLong_valueOfWithLong_(key)];
      }
    }
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) removeWithLongArray:keys];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) onItemsRemovedWithLongArray:keys];
    }
  }
}

- (void)clear {
  @synchronized(LOCK_) {
    [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) clear];
    [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) clear];
    for (id<ImActorModelDroidkitEngineListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<ImActorModelDroidkitEngineListEngineDisplayListener>) nil_chk(l)) onListClear];
    }
  }
}

- (id)getValueWithLong:(jlong)key {
  @synchronized(LOCK_) {
    BSBserObject<ImActorModelDroidkitEngineListEngineItem> *res = [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) lookupWithId:JavaLangLong_valueOfWithLong_(key)];
    if (res != nil) {
      return res;
    }
  }
  BSBserObject<ImActorModelDroidkitEngineListEngineItem> *res = [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) getValueWithLong:key];
  if (res != nil) {
    @synchronized(LOCK_) {
      [cache_ onObjectLoadedWithId:JavaLangLong_valueOfWithLong_(key) withId:res];
    }
  }
  return res;
}

- (id)getHeadValue {
  BSBserObject<ImActorModelDroidkitEngineListEngineItem> *res = [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) getHeadValue];
  if (res != nil) {
    @synchronized(LOCK_) {
      [((ImActorModelDroidkitEngineObjectCache *) nil_chk(cache_)) onObjectLoadedWithId:JavaLangLong_valueOfWithLong_([res getEngineId]) withId:res];
    }
  }
  return res;
}

- (jint)getCount {
  return [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) getCount];
}

- (void)subscribeWithImActorModelDroidkitEngineListEngineDisplayListener:(id<ImActorModelDroidkitEngineListEngineDisplayListener>)listener {
  if (![((JavaUtilConcurrentCopyOnWriteArrayList *) nil_chk(listeners_)) containsWithId:listener]) {
    [listeners_ addWithId:listener];
  }
}

- (void)unsubscribeWithImActorModelDroidkitEngineListEngineDisplayListener:(id<ImActorModelDroidkitEngineListEngineDisplayListener>)listener {
  [((JavaUtilConcurrentCopyOnWriteArrayList *) nil_chk(listeners_)) removeWithId:listener];
}

- (void)loadForwardWithInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:nil withJavaLangLong:nil withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadForwardWithLong:(jlong)afterSortKey
                    withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:nil withJavaLangLong:JavaLangLong_valueOfWithLong_(afterSortKey) withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadForwardWithNSString:(NSString *)query
                        withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:query withJavaLangLong:nil withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadForwardWithNSString:(NSString *)query
                       withLong:(jlong)afterSortKey
                        withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:query withJavaLangLong:JavaLangLong_valueOfWithLong_(afterSortKey) withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadBackwardWithInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:nil withJavaLangLong:nil withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadBackwardWithLong:(jlong)beforeSortKey
                     withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:nil withJavaLangLong:JavaLangLong_valueOfWithLong_(beforeSortKey) withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadBackwardWithNSString:(NSString *)query
                         withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:query withJavaLangLong:nil withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadBackwardWithNSString:(NSString *)query
                        withLong:(jlong)beforeSortKey
                         withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:query withJavaLangLong:JavaLangLong_valueOfWithLong_(beforeSortKey) withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (void)loadCenterWithLong:(jlong)centerSortKey
                   withInt:(jint)limit
withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  [((ImActorModelDroidkitEngineAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadCenterWithLong:centerSortKey withInt:limit withImActorModelDroidkitEngineListEngineCallback:ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback)];
}

- (id<ImActorModelDroidkitEngineListEngineCallback>)coverWithImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)callback {
  return ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(self, callback);
}

- (void)copyAllFieldsTo:(ImActorModelDroidkitEngineAsyncListEngine *)other {
  [super copyAllFieldsTo:other];
  other->asyncStorageInt_ = asyncStorageInt_;
  other->cache_ = cache_;
  other->LOCK_ = LOCK_;
  other->listeners_ = listeners_;
}

@end

id<ImActorModelDroidkitEngineListEngineCallback> ImActorModelDroidkitEngineAsyncListEngine_coverWithImActorModelDroidkitEngineListEngineCallback_(ImActorModelDroidkitEngineAsyncListEngine *self, id<ImActorModelDroidkitEngineListEngineCallback> callback) {
  return [[ImActorModelDroidkitEngineAsyncListEngine_$1 alloc] initWithImActorModelDroidkitEngineAsyncListEngine:self withImActorModelDroidkitEngineListEngineCallback:callback];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelDroidkitEngineAsyncListEngine)

@implementation ImActorModelDroidkitEngineAsyncListEngine_$1

- (void)onLoadedWithJavaUtilList:(id<JavaUtilList>)items
                        withLong:(jlong)topSortKey
                        withLong:(jlong)bottomSortKey {
  @synchronized(this$0_->LOCK_) {
    for (BSBserObject<ImActorModelDroidkitEngineListEngineItem> * __strong i in nil_chk(items)) {
      [((ImActorModelDroidkitEngineObjectCache *) nil_chk(this$0_->cache_)) onObjectLoadedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<ImActorModelDroidkitEngineListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
  }
  [((id<ImActorModelDroidkitEngineListEngineCallback>) nil_chk(val$callback_)) onLoadedWithJavaUtilList:items withLong:topSortKey withLong:bottomSortKey];
}

- (instancetype)initWithImActorModelDroidkitEngineAsyncListEngine:(ImActorModelDroidkitEngineAsyncListEngine *)outer$
                 withImActorModelDroidkitEngineListEngineCallback:(id<ImActorModelDroidkitEngineListEngineCallback>)capture$0 {
  this$0_ = outer$;
  val$callback_ = capture$0;
  return [super init];
}

- (void)copyAllFieldsTo:(ImActorModelDroidkitEngineAsyncListEngine_$1 *)other {
  [super copyAllFieldsTo:other];
  other->this$0_ = this$0_;
  other->val$callback_ = val$callback_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelDroidkitEngineAsyncListEngine_$1)
