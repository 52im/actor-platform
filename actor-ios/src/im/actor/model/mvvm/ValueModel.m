//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/actor-ios/build/java/im/actor/model/mvvm/ValueModel.java
//

#include "IOSObjectArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/MainThreadProvider.h"
#include "im/actor/model/mvvm/MVVMEngine.h"
#include "im/actor/model/mvvm/ValueChangedListener.h"
#include "im/actor/model/mvvm/ValueModel.h"
#include "java/util/ArrayList.h"

__attribute__((unused)) static void AMValueModel_notifyWithId_(AMValueModel *self, id value);

@interface AMValueModel () {
 @public
  JavaUtilArrayList *listeners_;
  NSString *name_;
  id value_;
}

- (void)notifyWithId:(id)value;
@end

J2OBJC_FIELD_SETTER(AMValueModel, listeners_, JavaUtilArrayList *)
J2OBJC_FIELD_SETTER(AMValueModel, name_, NSString *)
J2OBJC_FIELD_SETTER(AMValueModel, value_, id)

@interface AMValueModel_$1 () {
 @public
  AMValueModel *this$0_;
  id val$value_;
}
@end

J2OBJC_FIELD_SETTER(AMValueModel_$1, this$0_, AMValueModel *)
J2OBJC_FIELD_SETTER(AMValueModel_$1, val$value_, id)

@implementation AMValueModel

- (instancetype)initWithNSString:(NSString *)name
                          withId:(id)defaultValue {
  if (self = [super init]) {
    listeners_ = [[JavaUtilArrayList alloc] init];
    self->name_ = name;
    self->value_ = defaultValue;
  }
  return self;
}

- (id)get {
  return value_;
}

- (jboolean)changeWithId:(id)value {
  if (self->value_ != nil && value != nil && [value isEqual:self->value_]) {
    return NO;
  }
  self->value_ = value;
  AMValueModel_notifyWithId_(self, value);
  return YES;
}

- (void)subscribeWithAMValueChangedListener:(id<AMValueChangedListener>)listener {
  AMMVVMEngine_checkMainThread();
  [self subscribeWithAMValueChangedListener:listener withBoolean:YES];
}

- (void)subscribeWithAMValueChangedListener:(id<AMValueChangedListener>)listener
                                withBoolean:(jboolean)notify {
  AMMVVMEngine_checkMainThread();
  if ([((JavaUtilArrayList *) nil_chk(listeners_)) containsWithId:listener]) {
    return;
  }
  [listeners_ addWithId:listener];
  if (notify) {
    [((id<AMValueChangedListener>) nil_chk(listener)) onChangedWithId:value_ withAMValueModel:self];
  }
}

- (void)unsubscribeWithAMValueChangedListener:(id<AMValueChangedListener>)listener {
  AMMVVMEngine_checkMainThread();
  [((JavaUtilArrayList *) nil_chk(listeners_)) removeWithId:listener];
}

- (void)notifyWithId:(id)value {
  AMValueModel_notifyWithId_(self, value);
}

- (NSString *)description {
  return JreStrcat("@", value_);
}

- (void)copyAllFieldsTo:(AMValueModel *)other {
  [super copyAllFieldsTo:other];
  other->listeners_ = listeners_;
  other->name_ = name_;
  other->value_ = value_;
}

@end

void AMValueModel_notifyWithId_(AMValueModel *self, id value) {
  [((id<AMMainThreadProvider>) nil_chk(AMMVVMEngine_getMainThreadProvider())) runOnUiThreadWithJavaLangRunnable:[[AMValueModel_$1 alloc] initWithAMValueModel:self withId:value]];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(AMValueModel)

@implementation AMValueModel_$1

- (void)run {
  {
    IOSObjectArray *a__ = [this$0_->listeners_ toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:[((JavaUtilArrayList *) nil_chk(this$0_->listeners_)) size] type:AMValueChangedListener_class_()]];
    id<AMValueChangedListener> const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    id<AMValueChangedListener> const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      id<AMValueChangedListener> listener = *b__++;
      [((id<AMValueChangedListener>) nil_chk(listener)) onChangedWithId:val$value_ withAMValueModel:this$0_];
    }
  }
}

- (instancetype)initWithAMValueModel:(AMValueModel *)outer$
                              withId:(id)capture$0 {
  this$0_ = outer$;
  val$value_ = capture$0;
  return [super init];
}

- (void)copyAllFieldsTo:(AMValueModel_$1 *)other {
  [super copyAllFieldsTo:other];
  other->this$0_ = this$0_;
  other->val$value_ = val$value_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(AMValueModel_$1)
