//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/actor-ios/build/java/im/actor/model/modules/messages/SenderActor.java
//

#include "IOSClass.h"
#include "IOSObjectArray.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/Configuration.h"
#include "im/actor/model/FileSystemProvider.h"
#include "im/actor/model/api/DocumentEx.h"
#include "im/actor/model/api/DocumentExPhoto.h"
#include "im/actor/model/api/DocumentExVideo.h"
#include "im/actor/model/api/DocumentMessage.h"
#include "im/actor/model/api/FastThumb.h"
#include "im/actor/model/api/Message.h"
#include "im/actor/model/api/OutPeer.h"
#include "im/actor/model/api/Peer.h"
#include "im/actor/model/api/TextMessage.h"
#include "im/actor/model/api/base/SeqUpdate.h"
#include "im/actor/model/api/rpc/RequestSendMessage.h"
#include "im/actor/model/api/rpc/ResponseSeqDate.h"
#include "im/actor/model/api/updates/UpdateMessageSent.h"
#include "im/actor/model/droidkit/actors/Actor.h"
#include "im/actor/model/droidkit/actors/ActorRef.h"
#include "im/actor/model/entity/FileReference.h"
#include "im/actor/model/entity/Message.h"
#include "im/actor/model/entity/MessageState.h"
#include "im/actor/model/entity/Peer.h"
#include "im/actor/model/entity/content/AbsContent.h"
#include "im/actor/model/entity/content/DocumentContent.h"
#include "im/actor/model/entity/content/FastThumb.h"
#include "im/actor/model/entity/content/FileLocalSource.h"
#include "im/actor/model/entity/content/FileRemoteSource.h"
#include "im/actor/model/entity/content/FileSource.h"
#include "im/actor/model/entity/content/PhotoContent.h"
#include "im/actor/model/entity/content/TextContent.h"
#include "im/actor/model/entity/content/VideoContent.h"
#include "im/actor/model/modules/Files.h"
#include "im/actor/model/modules/Modules.h"
#include "im/actor/model/modules/Updates.h"
#include "im/actor/model/modules/file/UploadManager.h"
#include "im/actor/model/modules/messages/ConversationActor.h"
#include "im/actor/model/modules/messages/SenderActor.h"
#include "im/actor/model/modules/messages/entity/PendingMessage.h"
#include "im/actor/model/modules/messages/entity/PendingMessagesStorage.h"
#include "im/actor/model/modules/utils/ModuleActor.h"
#include "im/actor/model/modules/utils/RandomUtils.h"
#include "im/actor/model/network/RpcException.h"
#include "im/actor/model/storage/PreferencesStorage.h"
#include "java/io/IOException.h"
#include "java/lang/Long.h"
#include "java/lang/System.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"

__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(ImActorModelModulesMessagesSenderActor *self, jlong rid, NSString *descriptor, NSString *fileName);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_onFileUploadedWithLong_withAMFileReference_(ImActorModelModulesMessagesSenderActor *self, jlong rid, AMFileReference *fileReference);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_onFileUploadErrorWithLong_(ImActorModelModulesMessagesSenderActor *self, jlong rid);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid, AMAbsContent *content);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_onSentWithAMPeer_withLong_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_onErrorWithAMPeer_withLong_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid);
__attribute__((unused)) static void ImActorModelModulesMessagesSenderActor_savePending(ImActorModelModulesMessagesSenderActor *self);
__attribute__((unused)) static ImActorModelModulesMessagesEntityPendingMessage *ImActorModelModulesMessagesSenderActor_findPendingWithLong_(ImActorModelModulesMessagesSenderActor *self, jlong rid);

@interface ImActorModelModulesMessagesSenderActor () {
 @public
  ImActorModelModulesMessagesEntityPendingMessagesStorage *pendingMessages_;
}

- (void)performUploadFileWithLong:(jlong)rid
                     withNSString:(NSString *)descriptor
                     withNSString:(NSString *)fileName;

- (void)onFileUploadedWithLong:(jlong)rid
           withAMFileReference:(AMFileReference *)fileReference;

- (void)onFileUploadErrorWithLong:(jlong)rid;

- (void)performSendContentWithAMPeer:(AMPeer *)peer
                            withLong:(jlong)rid
                    withAMAbsContent:(AMAbsContent *)content;

- (void)onSentWithAMPeer:(AMPeer *)peer
                withLong:(jlong)rid;

- (void)onErrorWithAMPeer:(AMPeer *)peer
                 withLong:(jlong)rid;

- (void)savePending;

- (ImActorModelModulesMessagesEntityPendingMessage *)findPendingWithLong:(jlong)rid;
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor, pendingMessages_, ImActorModelModulesMessagesEntityPendingMessagesStorage *)

@interface ImActorModelModulesMessagesSenderActor_SendDocument () {
 @public
  AMPeer *peer_;
  AMFastThumb *fastThumb_;
  NSString *descriptor_;
  NSString *fileName_;
  NSString *mimeType_;
  jint fileSize_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendDocument, peer_, AMPeer *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendDocument, fastThumb_, AMFastThumb *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendDocument, descriptor_, NSString *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendDocument, fileName_, NSString *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendDocument, mimeType_, NSString *)

@interface ImActorModelModulesMessagesSenderActor_SendPhoto () {
 @public
  AMPeer *peer_;
  AMFastThumb *fastThumb_;
  NSString *descriptor_;
  NSString *fileName_;
  jint fileSize_;
  jint w_;
  jint h_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendPhoto, peer_, AMPeer *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendPhoto, fastThumb_, AMFastThumb *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendPhoto, descriptor_, NSString *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendPhoto, fileName_, NSString *)

@interface ImActorModelModulesMessagesSenderActor_SendVideo () {
 @public
  AMPeer *peer_;
  NSString *fileName_;
  jint w_;
  jint h_;
  jint duration_;
  AMFastThumb *fastThumb_;
  NSString *descriptor_;
  jint fileSize_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendVideo, peer_, AMPeer *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendVideo, fileName_, NSString *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendVideo, fastThumb_, AMFastThumb *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendVideo, descriptor_, NSString *)

@interface ImActorModelModulesMessagesSenderActor_SendText () {
 @public
  AMPeer *peer_;
  NSString *text_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendText, peer_, AMPeer *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_SendText, text_, NSString *)

@interface ImActorModelModulesMessagesSenderActor_MessageSent () {
 @public
  AMPeer *peer_;
  jlong rid_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_MessageSent, peer_, AMPeer *)

@interface ImActorModelModulesMessagesSenderActor_MessageError () {
 @public
  AMPeer *peer_;
  jlong rid_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_MessageError, peer_, AMPeer *)

@interface ImActorModelModulesMessagesSenderActor_$1 () {
 @public
  ImActorModelModulesMessagesSenderActor *this$0_;
  AMPeer *val$peer_;
  jlong val$rid_;
  ImActorModelApiPeer *val$apiPeer_;
}
@end

J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_$1, this$0_, ImActorModelModulesMessagesSenderActor *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_$1, val$peer_, AMPeer *)
J2OBJC_FIELD_SETTER(ImActorModelModulesMessagesSenderActor_$1, val$apiPeer_, ImActorModelApiPeer *)

@implementation ImActorModelModulesMessagesSenderActor

NSString * ImActorModelModulesMessagesSenderActor_PREFERENCES_ = @"sender_pending";

- (instancetype)initWithImActorModelModulesModules:(ImActorModelModulesModules *)messenger {
  return [super initWithImActorModelModulesModules:messenger];
}

- (void)preStart {
  pendingMessages_ = [[ImActorModelModulesMessagesEntityPendingMessagesStorage alloc] init];
  IOSByteArray *p = [((id<AMPreferencesStorage>) nil_chk([self preferences])) getBytesWithNSString:ImActorModelModulesMessagesSenderActor_PREFERENCES_];
  if (p != nil) {
    @try {
      pendingMessages_ = ImActorModelModulesMessagesEntityPendingMessagesStorage_fromBytesWithByteArray_(p);
    }
    @catch (JavaIoIOException *e) {
      [((JavaIoIOException *) nil_chk(e)) printStackTrace];
    }
  }
  jboolean isChanged = NO;
  {
    IOSObjectArray *a__ = [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(pendingMessages_)) getPendingMessages])) toArrayWithNSObjectArray:[IOSObjectArray newArrayWithLength:0 type:ImActorModelModulesMessagesEntityPendingMessage_class_()]];
    ImActorModelModulesMessagesEntityPendingMessage * const *b__ = ((IOSObjectArray *) nil_chk(a__))->buffer_;
    ImActorModelModulesMessagesEntityPendingMessage * const *e__ = b__ + a__->size_;
    while (b__ < e__) {
      ImActorModelModulesMessagesEntityPendingMessage *pending = *b__++;
      if ([[((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(pending)) getContent] isKindOfClass:[AMTextContent class]]) {
        ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(self, [pending getPeer], [pending getRid], [pending getContent]);
      }
      else if ([[pending getContent] isKindOfClass:[AMDocumentContent class]]) {
        AMDocumentContent *documentContent = (AMDocumentContent *) check_class_cast([pending getContent], [AMDocumentContent class]);
        if ([[((AMDocumentContent *) nil_chk(documentContent)) getSource] isKindOfClass:[AMFileLocalSource class]]) {
          if ([((AMConfiguration *) nil_chk([self config])) getFileSystemProvider] != nil && [((id<AMFileSystemProvider>) nil_chk([((AMConfiguration *) nil_chk([self config])) getFileSystemProvider])) isFsPersistent]) {
            ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(self, [pending getRid], [((AMFileLocalSource *) nil_chk(((AMFileLocalSource *) check_class_cast([documentContent getSource], [AMFileLocalSource class])))) getFileDescriptor], [((AMFileLocalSource *) nil_chk(((AMFileLocalSource *) check_class_cast([documentContent getSource], [AMFileLocalSource class])))) getFileName]);
          }
          else {
            id<JavaUtilList> rids = [[JavaUtilArrayList alloc] init];
            [rids addWithId:JavaLangLong_valueOfWithLong_([pending getRid])];
            [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:[pending getPeer]])) sendWithId:[[ImActorModelModulesMessagesConversationActor_MessagesDeleted alloc] initWithJavaUtilList:rids]];
            [((JavaUtilArrayList *) nil_chk([pendingMessages_ getPendingMessages])) removeWithId:pending];
            isChanged = YES;
          }
        }
        else {
          ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(self, [pending getPeer], [pending getRid], [pending getContent]);
        }
      }
    }
  }
  if (isChanged) {
    ImActorModelModulesMessagesSenderActor_savePending(self);
  }
}

- (void)doSendTextWithAMPeer:(AMPeer *)peer
                withNSString:(NSString *)text {
  jlong rid = ImActorModelModulesUtilsRandomUtils_nextRid();
  jlong date = JavaLangSystem_currentTimeMillis();
  AMMessage *message = [[AMMessage alloc] initWithLong:rid withLong:date withLong:date withInt:[self myUid] withAMMessageStateEnum:AMMessageStateEnum_get_PENDING() withAMAbsContent:[[AMTextContent alloc] initWithNSString:text]];
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:peer])) sendWithId:message];
  [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(pendingMessages_)) getPendingMessages])) addWithId:[[ImActorModelModulesMessagesEntityPendingMessage alloc] initWithAMPeer:peer withLong:rid withAMAbsContent:[[AMTextContent alloc] initWithNSString:text]]];
  ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(self, peer, rid, [[AMTextContent alloc] initWithNSString:text]);
}

- (void)doSendDocumentWithAMPeer:(AMPeer *)peer
                    withNSString:(NSString *)fileName
                    withNSString:(NSString *)mimeType
                         withInt:(jint)fileSize
                 withAMFastThumb:(AMFastThumb *)fastThumb
                    withNSString:(NSString *)descriptor {
  jlong rid = ImActorModelModulesUtilsRandomUtils_nextRid();
  jlong date = JavaLangSystem_currentTimeMillis();
  AMDocumentContent *documentContent = [[AMDocumentContent alloc] initWithAMFileSource:[[AMFileLocalSource alloc] initWithNSString:fileName withInt:fileSize withNSString:descriptor] withNSString:mimeType withNSString:fileName withAMFastThumb:fastThumb];
  AMMessage *message = [[AMMessage alloc] initWithLong:rid withLong:date withLong:date withInt:[self myUid] withAMMessageStateEnum:AMMessageStateEnum_get_PENDING() withAMAbsContent:documentContent];
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:peer])) sendWithId:message];
  [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(pendingMessages_)) getPendingMessages])) addWithId:[[ImActorModelModulesMessagesEntityPendingMessage alloc] initWithAMPeer:peer withLong:rid withAMAbsContent:documentContent]];
  ImActorModelModulesMessagesSenderActor_savePending(self);
  ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(self, rid, descriptor, fileName);
}

- (void)doSendPhotoWithAMPeer:(AMPeer *)peer
              withAMFastThumb:(AMFastThumb *)fastThumb
                 withNSString:(NSString *)descriptor
                 withNSString:(NSString *)fileName
                      withInt:(jint)fileSize
                      withInt:(jint)w
                      withInt:(jint)h {
  jlong rid = ImActorModelModulesUtilsRandomUtils_nextRid();
  jlong date = JavaLangSystem_currentTimeMillis();
  AMPhotoContent *photoContent = [[AMPhotoContent alloc] initWithAMFileSource:[[AMFileLocalSource alloc] initWithNSString:fileName withInt:fileSize withNSString:descriptor] withNSString:@"image/jpeg" withNSString:fileName withAMFastThumb:fastThumb withInt:w withInt:h];
  AMMessage *message = [[AMMessage alloc] initWithLong:rid withLong:date withLong:date withInt:[self myUid] withAMMessageStateEnum:AMMessageStateEnum_get_PENDING() withAMAbsContent:photoContent];
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:peer])) sendWithId:message];
  [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(pendingMessages_)) getPendingMessages])) addWithId:[[ImActorModelModulesMessagesEntityPendingMessage alloc] initWithAMPeer:peer withLong:rid withAMAbsContent:photoContent]];
  ImActorModelModulesMessagesSenderActor_savePending(self);
  ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(self, rid, descriptor, fileName);
}

- (void)doSendVideoWithAMPeer:(AMPeer *)peer
                 withNSString:(NSString *)fileName
                      withInt:(jint)w
                      withInt:(jint)h
                      withInt:(jint)duration
              withAMFastThumb:(AMFastThumb *)fastThumb
                 withNSString:(NSString *)descriptor
                      withInt:(jint)fileSize {
  jlong rid = ImActorModelModulesUtilsRandomUtils_nextRid();
  jlong date = JavaLangSystem_currentTimeMillis();
  AMVideoContent *videoContent = [[AMVideoContent alloc] initWithAMFileSource:[[AMFileLocalSource alloc] initWithNSString:fileName withInt:fileSize withNSString:descriptor] withNSString:@"video/mp4" withNSString:fileName withAMFastThumb:fastThumb withInt:duration withInt:w withInt:h];
  AMMessage *message = [[AMMessage alloc] initWithLong:rid withLong:date withLong:date withInt:[self myUid] withAMMessageStateEnum:AMMessageStateEnum_get_PENDING() withAMAbsContent:videoContent];
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:peer])) sendWithId:message];
  [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(pendingMessages_)) getPendingMessages])) addWithId:[[ImActorModelModulesMessagesEntityPendingMessage alloc] initWithAMPeer:peer withLong:rid withAMAbsContent:videoContent]];
  ImActorModelModulesMessagesSenderActor_savePending(self);
  ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(self, rid, descriptor, fileName);
}

- (void)performUploadFileWithLong:(jlong)rid
                     withNSString:(NSString *)descriptor
                     withNSString:(NSString *)fileName {
  ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(self, rid, descriptor, fileName);
}

- (void)onFileUploadedWithLong:(jlong)rid
           withAMFileReference:(AMFileReference *)fileReference {
  ImActorModelModulesMessagesSenderActor_onFileUploadedWithLong_withAMFileReference_(self, rid, fileReference);
}

- (void)onFileUploadErrorWithLong:(jlong)rid {
  ImActorModelModulesMessagesSenderActor_onFileUploadErrorWithLong_(self, rid);
}

- (void)performSendContentWithAMPeer:(AMPeer *)peer
                            withLong:(jlong)rid
                    withAMAbsContent:(AMAbsContent *)content {
  ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(self, peer, rid, content);
}

- (void)onSentWithAMPeer:(AMPeer *)peer
                withLong:(jlong)rid {
  ImActorModelModulesMessagesSenderActor_onSentWithAMPeer_withLong_(self, peer, rid);
}

- (void)onErrorWithAMPeer:(AMPeer *)peer
                 withLong:(jlong)rid {
  ImActorModelModulesMessagesSenderActor_onErrorWithAMPeer_withLong_(self, peer, rid);
}

- (void)savePending {
  ImActorModelModulesMessagesSenderActor_savePending(self);
}

- (ImActorModelModulesMessagesEntityPendingMessage *)findPendingWithLong:(jlong)rid {
  return ImActorModelModulesMessagesSenderActor_findPendingWithLong_(self, rid);
}

- (void)onReceiveWithId:(id)message {
  if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_SendText class]]) {
    ImActorModelModulesMessagesSenderActor_SendText *sendText = (ImActorModelModulesMessagesSenderActor_SendText *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_SendText class]);
    [self doSendTextWithAMPeer:[((ImActorModelModulesMessagesSenderActor_SendText *) nil_chk(sendText)) getPeer] withNSString:[sendText getText]];
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_MessageSent class]]) {
    ImActorModelModulesMessagesSenderActor_MessageSent *messageSent = (ImActorModelModulesMessagesSenderActor_MessageSent *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_MessageSent class]);
    ImActorModelModulesMessagesSenderActor_onSentWithAMPeer_withLong_(self, [((ImActorModelModulesMessagesSenderActor_MessageSent *) nil_chk(messageSent)) getPeer], [messageSent getRid]);
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_MessageError class]]) {
    ImActorModelModulesMessagesSenderActor_MessageError *messageError = (ImActorModelModulesMessagesSenderActor_MessageError *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_MessageError class]);
    ImActorModelModulesMessagesSenderActor_onErrorWithAMPeer_withLong_(self, [((ImActorModelModulesMessagesSenderActor_MessageError *) nil_chk(messageError)) getPeer], [messageError getRid]);
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_SendDocument class]]) {
    ImActorModelModulesMessagesSenderActor_SendDocument *sendDocument = (ImActorModelModulesMessagesSenderActor_SendDocument *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_SendDocument class]);
    [self doSendDocumentWithAMPeer:[((ImActorModelModulesMessagesSenderActor_SendDocument *) nil_chk(sendDocument)) getPeer] withNSString:[sendDocument getFileName] withNSString:[sendDocument getMimeType] withInt:[sendDocument getFileSize] withAMFastThumb:[sendDocument getFastThumb] withNSString:[sendDocument getDescriptor]];
  }
  else if ([message isKindOfClass:[ImActorModelModulesFileUploadManager_UploadCompleted class]]) {
    ImActorModelModulesFileUploadManager_UploadCompleted *uploadCompleted = (ImActorModelModulesFileUploadManager_UploadCompleted *) check_class_cast(message, [ImActorModelModulesFileUploadManager_UploadCompleted class]);
    ImActorModelModulesMessagesSenderActor_onFileUploadedWithLong_withAMFileReference_(self, [((ImActorModelModulesFileUploadManager_UploadCompleted *) nil_chk(uploadCompleted)) getRid], [uploadCompleted getFileReference]);
  }
  else if ([message isKindOfClass:[ImActorModelModulesFileUploadManager_UploadError class]]) {
    ImActorModelModulesFileUploadManager_UploadError *uploadError = (ImActorModelModulesFileUploadManager_UploadError *) check_class_cast(message, [ImActorModelModulesFileUploadManager_UploadError class]);
    ImActorModelModulesMessagesSenderActor_onFileUploadErrorWithLong_(self, [((ImActorModelModulesFileUploadManager_UploadError *) nil_chk(uploadError)) getRid]);
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_SendPhoto class]]) {
    ImActorModelModulesMessagesSenderActor_SendPhoto *sendPhoto = (ImActorModelModulesMessagesSenderActor_SendPhoto *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_SendPhoto class]);
    [self doSendPhotoWithAMPeer:[((ImActorModelModulesMessagesSenderActor_SendPhoto *) nil_chk(sendPhoto)) getPeer] withAMFastThumb:[sendPhoto getFastThumb] withNSString:[sendPhoto getDescriptor] withNSString:[sendPhoto getFileName] withInt:[sendPhoto getFileSize] withInt:[sendPhoto getW] withInt:[sendPhoto getH]];
  }
  else if ([message isKindOfClass:[ImActorModelModulesMessagesSenderActor_SendVideo class]]) {
    ImActorModelModulesMessagesSenderActor_SendVideo *sendVideo = (ImActorModelModulesMessagesSenderActor_SendVideo *) check_class_cast(message, [ImActorModelModulesMessagesSenderActor_SendVideo class]);
    [self doSendVideoWithAMPeer:[((ImActorModelModulesMessagesSenderActor_SendVideo *) nil_chk(sendVideo)) getPeer] withNSString:[sendVideo getFileName] withInt:[sendVideo getW] withInt:[sendVideo getH] withInt:[sendVideo getDuration] withAMFastThumb:[sendVideo getFastThumb] withNSString:[sendVideo getDescriptor] withInt:[sendVideo getFileSize]];
  }
  else {
    [self dropWithId:message];
  }
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor *)other {
  [super copyAllFieldsTo:other];
  other->pendingMessages_ = pendingMessages_;
}

@end

void ImActorModelModulesMessagesSenderActor_performUploadFileWithLong_withNSString_withNSString_(ImActorModelModulesMessagesSenderActor *self, jlong rid, NSString *descriptor, NSString *fileName) {
  [((ImActorModelModulesFiles *) nil_chk([((ImActorModelModulesModules *) nil_chk([self modules])) getFilesModule])) requestUploadWithLong:rid withNSString:descriptor withNSString:fileName withDKActorRef:[self self__]];
}

void ImActorModelModulesMessagesSenderActor_onFileUploadedWithLong_withAMFileReference_(ImActorModelModulesMessagesSenderActor *self, jlong rid, AMFileReference *fileReference) {
  ImActorModelModulesMessagesEntityPendingMessage *msg = ImActorModelModulesMessagesSenderActor_findPendingWithLong_(self, rid);
  if (msg == nil) {
    return;
  }
  [((JavaUtilArrayList *) nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(self->pendingMessages_)) getPendingMessages])) removeWithId:msg];
  AMAbsContent *nContent;
  if ([[((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(msg)) getContent] isKindOfClass:[AMPhotoContent class]]) {
    AMPhotoContent *basePhotoContent = (AMPhotoContent *) check_class_cast([msg getContent], [AMPhotoContent class]);
    nContent = [[AMPhotoContent alloc] initWithAMFileSource:[[AMFileRemoteSource alloc] initWithAMFileReference:fileReference] withNSString:[((AMPhotoContent *) nil_chk(basePhotoContent)) getMimetype] withNSString:[basePhotoContent getName] withAMFastThumb:[basePhotoContent getFastThumb] withInt:[basePhotoContent getW] withInt:[basePhotoContent getH]];
  }
  else if ([[msg getContent] isKindOfClass:[AMVideoContent class]]) {
    AMVideoContent *baseVideoContent = (AMVideoContent *) check_class_cast([msg getContent], [AMVideoContent class]);
    nContent = [[AMVideoContent alloc] initWithAMFileSource:[[AMFileRemoteSource alloc] initWithAMFileReference:fileReference] withNSString:[((AMVideoContent *) nil_chk(baseVideoContent)) getMimetype] withNSString:[baseVideoContent getName] withAMFastThumb:[baseVideoContent getFastThumb] withInt:[baseVideoContent getDuration] withInt:[baseVideoContent getW] withInt:[baseVideoContent getH]];
  }
  else if ([[msg getContent] isKindOfClass:[AMDocumentContent class]]) {
    AMDocumentContent *baseDocContent = (AMDocumentContent *) check_class_cast([msg getContent], [AMDocumentContent class]);
    nContent = [[AMDocumentContent alloc] initWithAMFileSource:[[AMFileRemoteSource alloc] initWithAMFileReference:fileReference] withNSString:[((AMDocumentContent *) nil_chk(baseDocContent)) getMimetype] withNSString:[baseDocContent getName] withAMFastThumb:[baseDocContent getFastThumb]];
  }
  else {
    return;
  }
  [((JavaUtilArrayList *) nil_chk([self->pendingMessages_ getPendingMessages])) addWithId:[[ImActorModelModulesMessagesEntityPendingMessage alloc] initWithAMPeer:[msg getPeer] withLong:[msg getRid] withAMAbsContent:nContent]];
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:[msg getPeer]])) sendWithId:[[ImActorModelModulesMessagesConversationActor_MessageContentUpdated alloc] initWithLong:[msg getRid] withAMAbsContent:nContent]];
  ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(self, [msg getPeer], rid, nContent);
}

void ImActorModelModulesMessagesSenderActor_onFileUploadErrorWithLong_(ImActorModelModulesMessagesSenderActor *self, jlong rid) {
  ImActorModelModulesMessagesEntityPendingMessage *msg = ImActorModelModulesMessagesSenderActor_findPendingWithLong_(self, rid);
  if (msg == nil) {
    return;
  }
  [((DKActorRef *) nil_chk([self self__])) sendWithId:[[ImActorModelModulesMessagesSenderActor_MessageError alloc] initWithAMPeer:[((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(msg)) getPeer] withLong:[msg getRid]]];
}

void ImActorModelModulesMessagesSenderActor_performSendContentWithAMPeer_withLong_withAMAbsContent_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid, AMAbsContent *content) {
  ImActorModelApiOutPeer *outPeer = [self buidOutPeerWithAMPeer:peer];
  ImActorModelApiPeer *apiPeer = [self buildApiPeerWithAMPeer:peer];
  if (outPeer == nil || apiPeer == nil) {
    return;
  }
  ImActorModelApiMessage *message;
  if ([content isKindOfClass:[AMTextContent class]]) {
    message = [[ImActorModelApiTextMessage alloc] initWithNSString:[((AMTextContent *) nil_chk(((AMTextContent *) check_class_cast(content, [AMTextContent class])))) getText] withImActorModelApiTextMessageEx:nil];
  }
  else if ([content isKindOfClass:[AMDocumentContent class]]) {
    AMDocumentContent *documentContent = (AMDocumentContent *) check_class_cast(content, [AMDocumentContent class]);
    AMFileRemoteSource *source = (AMFileRemoteSource *) check_class_cast([((AMDocumentContent *) nil_chk(documentContent)) getSource], [AMFileRemoteSource class]);
    ImActorModelApiDocumentEx *documentEx = nil;
    if ([content isKindOfClass:[AMPhotoContent class]]) {
      AMPhotoContent *photoContent = (AMPhotoContent *) check_class_cast(content, [AMPhotoContent class]);
      documentEx = [[ImActorModelApiDocumentExPhoto alloc] initWithInt:[((AMPhotoContent *) nil_chk(photoContent)) getW] withInt:[photoContent getH]];
    }
    else if ([content isKindOfClass:[AMVideoContent class]]) {
      AMVideoContent *videoContent = (AMVideoContent *) check_class_cast(content, [AMVideoContent class]);
      documentEx = [[ImActorModelApiDocumentExVideo alloc] initWithInt:[((AMVideoContent *) nil_chk(videoContent)) getW] withInt:[videoContent getH] withInt:[videoContent getDuration]];
    }
    ImActorModelApiFastThumb *fastThumb = nil;
    if ([documentContent getFastThumb] != nil) {
      fastThumb = [[ImActorModelApiFastThumb alloc] initWithInt:[((AMFastThumb *) nil_chk([documentContent getFastThumb])) getW] withInt:[((AMFastThumb *) nil_chk([documentContent getFastThumb])) getH] withByteArray:[((AMFastThumb *) nil_chk([documentContent getFastThumb])) getImage]];
    }
    message = [[ImActorModelApiDocumentMessage alloc] initWithLong:[((AMFileReference *) nil_chk([((AMFileRemoteSource *) nil_chk(source)) getFileReference])) getFileId] withLong:[((AMFileReference *) nil_chk([source getFileReference])) getAccessHash] withInt:[((AMFileReference *) nil_chk([source getFileReference])) getFileSize] withImActorModelApiEncryptionTypeEnum:nil withByteArray:nil withJavaLangInteger:nil withNSString:[((AMFileReference *) nil_chk([source getFileReference])) getFileName] withNSString:[documentContent getMimetype] withImActorModelApiFastThumb:fastThumb withImActorModelApiDocumentEx:documentEx];
  }
  else {
    return;
  }
  [self requestWithImActorModelNetworkParserRequest:[[ImActorModelApiRpcRequestSendMessage alloc] initWithImActorModelApiOutPeer:outPeer withLong:rid withImActorModelApiMessage:message] withAMRpcCallback:[[ImActorModelModulesMessagesSenderActor_$1 alloc] initWithImActorModelModulesMessagesSenderActor:self withAMPeer:peer withLong:rid withImActorModelApiPeer:apiPeer]];
}

void ImActorModelModulesMessagesSenderActor_onSentWithAMPeer_withLong_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid) {
  for (ImActorModelModulesMessagesEntityPendingMessage * __strong pending in nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(self->pendingMessages_)) getPendingMessages])) {
    if ([((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(pending)) getRid] == rid && [((AMPeer *) nil_chk([pending getPeer])) isEqual:peer]) {
      [((JavaUtilArrayList *) nil_chk([self->pendingMessages_ getPendingMessages])) removeWithId:pending];
      break;
    }
  }
  ImActorModelModulesMessagesSenderActor_savePending(self);
}

void ImActorModelModulesMessagesSenderActor_onErrorWithAMPeer_withLong_(ImActorModelModulesMessagesSenderActor *self, AMPeer *peer, jlong rid) {
  for (ImActorModelModulesMessagesEntityPendingMessage * __strong pending in nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(self->pendingMessages_)) getPendingMessages])) {
    if ([((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(pending)) getRid] == rid && [((AMPeer *) nil_chk([pending getPeer])) isEqual:peer]) {
      [((JavaUtilArrayList *) nil_chk([self->pendingMessages_ getPendingMessages])) removeWithId:pending];
      break;
    }
  }
  ImActorModelModulesMessagesSenderActor_savePending(self);
  [((DKActorRef *) nil_chk([self getConversationActorWithAMPeer:peer])) sendWithId:[[ImActorModelModulesMessagesConversationActor_MessageError alloc] initWithLong:rid]];
}

void ImActorModelModulesMessagesSenderActor_savePending(ImActorModelModulesMessagesSenderActor *self) {
  [((id<AMPreferencesStorage>) nil_chk([self preferences])) putBytesWithNSString:ImActorModelModulesMessagesSenderActor_PREFERENCES_ withByteArray:[((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(self->pendingMessages_)) toByteArray]];
}

ImActorModelModulesMessagesEntityPendingMessage *ImActorModelModulesMessagesSenderActor_findPendingWithLong_(ImActorModelModulesMessagesSenderActor *self, jlong rid) {
  for (ImActorModelModulesMessagesEntityPendingMessage * __strong message in nil_chk([((ImActorModelModulesMessagesEntityPendingMessagesStorage *) nil_chk(self->pendingMessages_)) getPendingMessages])) {
    if ([((ImActorModelModulesMessagesEntityPendingMessage *) nil_chk(message)) getRid] == rid) {
      return message;
    }
  }
  return nil;
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor)

@implementation ImActorModelModulesMessagesSenderActor_SendDocument

- (instancetype)initWithAMPeer:(AMPeer *)peer
                  withNSString:(NSString *)fileName
                  withNSString:(NSString *)mimeType
                       withInt:(jint)fileSize
                  withNSString:(NSString *)descriptor
               withAMFastThumb:(AMFastThumb *)fastThumb {
  if (self = [super init]) {
    self->peer_ = peer;
    self->fastThumb_ = fastThumb;
    self->descriptor_ = descriptor;
    self->fileName_ = fileName;
    self->mimeType_ = mimeType;
    self->fileSize_ = fileSize;
  }
  return self;
}

- (AMFastThumb *)getFastThumb {
  return fastThumb_;
}

- (jint)getFileSize {
  return fileSize_;
}

- (NSString *)getFileName {
  return fileName_;
}

- (NSString *)getMimeType {
  return mimeType_;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (NSString *)getDescriptor {
  return descriptor_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_SendDocument *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->fastThumb_ = fastThumb_;
  other->descriptor_ = descriptor_;
  other->fileName_ = fileName_;
  other->mimeType_ = mimeType_;
  other->fileSize_ = fileSize_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_SendDocument)

@implementation ImActorModelModulesMessagesSenderActor_SendPhoto

- (instancetype)initWithAMPeer:(AMPeer *)peer
               withAMFastThumb:(AMFastThumb *)fastThumb
                  withNSString:(NSString *)descriptor
                  withNSString:(NSString *)fileName
                       withInt:(jint)fileSize
                       withInt:(jint)w
                       withInt:(jint)h {
  if (self = [super init]) {
    self->peer_ = peer;
    self->fastThumb_ = fastThumb;
    self->descriptor_ = descriptor;
    self->fileName_ = fileName;
    self->fileSize_ = fileSize;
    self->w_ = w;
    self->h_ = h;
  }
  return self;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (AMFastThumb *)getFastThumb {
  return fastThumb_;
}

- (NSString *)getDescriptor {
  return descriptor_;
}

- (NSString *)getFileName {
  return fileName_;
}

- (jint)getFileSize {
  return fileSize_;
}

- (jint)getW {
  return w_;
}

- (jint)getH {
  return h_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_SendPhoto *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->fastThumb_ = fastThumb_;
  other->descriptor_ = descriptor_;
  other->fileName_ = fileName_;
  other->fileSize_ = fileSize_;
  other->w_ = w_;
  other->h_ = h_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_SendPhoto)

@implementation ImActorModelModulesMessagesSenderActor_SendVideo

- (instancetype)initWithAMPeer:(AMPeer *)peer
                  withNSString:(NSString *)fileName
                       withInt:(jint)w
                       withInt:(jint)h
                       withInt:(jint)duration
               withAMFastThumb:(AMFastThumb *)fastThumb
                  withNSString:(NSString *)descriptor
                       withInt:(jint)fileSize {
  if (self = [super init]) {
    self->peer_ = peer;
    self->fileName_ = fileName;
    self->w_ = w;
    self->h_ = h;
    self->duration_ = duration;
    self->fastThumb_ = fastThumb;
    self->descriptor_ = descriptor;
    self->fileSize_ = fileSize;
  }
  return self;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (NSString *)getFileName {
  return fileName_;
}

- (jint)getW {
  return w_;
}

- (jint)getH {
  return h_;
}

- (jint)getDuration {
  return duration_;
}

- (AMFastThumb *)getFastThumb {
  return fastThumb_;
}

- (NSString *)getDescriptor {
  return descriptor_;
}

- (jint)getFileSize {
  return fileSize_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_SendVideo *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->fileName_ = fileName_;
  other->w_ = w_;
  other->h_ = h_;
  other->duration_ = duration_;
  other->fastThumb_ = fastThumb_;
  other->descriptor_ = descriptor_;
  other->fileSize_ = fileSize_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_SendVideo)

@implementation ImActorModelModulesMessagesSenderActor_SendText

- (instancetype)initWithAMPeer:(AMPeer *)peer
                  withNSString:(NSString *)text {
  if (self = [super init]) {
    self->peer_ = peer;
    self->text_ = text;
  }
  return self;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (NSString *)getText {
  return text_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_SendText *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->text_ = text_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_SendText)

@implementation ImActorModelModulesMessagesSenderActor_MessageSent

- (instancetype)initWithAMPeer:(AMPeer *)peer
                      withLong:(jlong)rid {
  if (self = [super init]) {
    self->peer_ = peer;
    self->rid_ = rid;
  }
  return self;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (jlong)getRid {
  return rid_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_MessageSent *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->rid_ = rid_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_MessageSent)

@implementation ImActorModelModulesMessagesSenderActor_MessageError

- (instancetype)initWithAMPeer:(AMPeer *)peer
                      withLong:(jlong)rid {
  if (self = [super init]) {
    self->peer_ = peer;
    self->rid_ = rid;
  }
  return self;
}

- (AMPeer *)getPeer {
  return peer_;
}

- (jlong)getRid {
  return rid_;
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_MessageError *)other {
  [super copyAllFieldsTo:other];
  other->peer_ = peer_;
  other->rid_ = rid_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_MessageError)

@implementation ImActorModelModulesMessagesSenderActor_$1

- (void)onResultWithImActorModelNetworkParserResponse:(ImActorModelApiRpcResponseSeqDate *)response {
  [((DKActorRef *) nil_chk([this$0_ self__])) sendWithId:[[ImActorModelModulesMessagesSenderActor_MessageSent alloc] initWithAMPeer:val$peer_ withLong:val$rid_]];
  [((ImActorModelModulesUpdates *) nil_chk([this$0_ updates])) onUpdateReceivedWithId:[[ImActorModelApiBaseSeqUpdate alloc] initWithInt:[((ImActorModelApiRpcResponseSeqDate *) nil_chk(response)) getSeq] withByteArray:[response getState] withInt:ImActorModelApiUpdatesUpdateMessageSent_HEADER withByteArray:[((ImActorModelApiUpdatesUpdateMessageSent *) [[ImActorModelApiUpdatesUpdateMessageSent alloc] initWithImActorModelApiPeer:val$apiPeer_ withLong:val$rid_ withLong:[response getDate]]) toByteArray]]];
}

- (void)onErrorWithAMRpcException:(AMRpcException *)e {
  [((DKActorRef *) nil_chk([this$0_ self__])) sendWithId:[[ImActorModelModulesMessagesSenderActor_MessageError alloc] initWithAMPeer:val$peer_ withLong:val$rid_]];
}

- (instancetype)initWithImActorModelModulesMessagesSenderActor:(ImActorModelModulesMessagesSenderActor *)outer$
                                                    withAMPeer:(AMPeer *)capture$0
                                                      withLong:(jlong)capture$1
                                       withImActorModelApiPeer:(ImActorModelApiPeer *)capture$2 {
  this$0_ = outer$;
  val$peer_ = capture$0;
  val$rid_ = capture$1;
  val$apiPeer_ = capture$2;
  return [super init];
}

- (void)copyAllFieldsTo:(ImActorModelModulesMessagesSenderActor_$1 *)other {
  [super copyAllFieldsTo:other];
  other->this$0_ = this$0_;
  other->val$peer_ = val$peer_;
  other->val$rid_ = val$rid_;
  other->val$apiPeer_ = val$apiPeer_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(ImActorModelModulesMessagesSenderActor_$1)
