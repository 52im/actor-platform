//
//  Generated by the J2ObjC translator.  DO NOT EDIT!
//  source: /Users/ex3ndr/Develop/actor-model/library/actor-cocoa-base/build/java/im/actor/model/droidkit/engine/AsyncListEngine.java
//

#include "IOSClass.h"
#include "IOSPrimitiveArray.h"
#include "J2ObjC_source.h"
#include "im/actor/model/droidkit/bser/BserCreator.h"
#include "im/actor/model/droidkit/bser/BserObject.h"
#include "im/actor/model/droidkit/engine/AsyncListEngine.h"
#include "im/actor/model/droidkit/engine/AsyncStorageInt.h"
#include "im/actor/model/droidkit/engine/ListEngineDisplayListener.h"
#include "im/actor/model/droidkit/engine/ListEngineDisplayLoadCallback.h"
#include "im/actor/model/droidkit/engine/ListEngineItem.h"
#include "im/actor/model/droidkit/engine/ListStorageDisplayEx.h"
#include "im/actor/model/droidkit/engine/ObjectCache.h"
#include "java/lang/Long.h"
#include "java/util/ArrayList.h"
#include "java/util/List.h"
#include "java/util/concurrent/CopyOnWriteArrayList.h"

__attribute__((unused)) static id<DKListEngineDisplayLoadCallback> DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(DKAsyncListEngine *self, id<DKListEngineDisplayLoadCallback> callback);

@interface DKAsyncListEngine () {
 @public
  DKAsyncStorageInt *asyncStorageInt_;
  DKObjectCache *cache_;
  id LOCK_;
  JavaUtilConcurrentCopyOnWriteArrayList *listeners_;
}

- (id<DKListEngineDisplayLoadCallback>)coverWithDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback;
@end

J2OBJC_FIELD_SETTER(DKAsyncListEngine, asyncStorageInt_, DKAsyncStorageInt *)
J2OBJC_FIELD_SETTER(DKAsyncListEngine, cache_, DKObjectCache *)
J2OBJC_FIELD_SETTER(DKAsyncListEngine, LOCK_, id)
J2OBJC_FIELD_SETTER(DKAsyncListEngine, listeners_, JavaUtilConcurrentCopyOnWriteArrayList *)

@interface DKAsyncListEngine_$1 () {
 @public
  DKAsyncListEngine *this$0_;
  id<DKListEngineDisplayLoadCallback> val$callback_;
}
@end

J2OBJC_FIELD_SETTER(DKAsyncListEngine_$1, this$0_, DKAsyncListEngine *)
J2OBJC_FIELD_SETTER(DKAsyncListEngine_$1, val$callback_, id<DKListEngineDisplayLoadCallback>)

@implementation DKAsyncListEngine

- (instancetype)initWithDKListStorageDisplayEx:(id<DKListStorageDisplayEx>)storage
                             withBSBserCreator:(id<BSBserCreator>)creator {
  if (self = [super init]) {
    cache_ = [[DKObjectCache alloc] init];
    LOCK_ = [[NSObject alloc] init];
    listeners_ = [[JavaUtilConcurrentCopyOnWriteArrayList alloc] init];
    self->asyncStorageInt_ = [[DKAsyncStorageInt alloc] initWithDKListStorageDisplayEx:storage withBSBserCreator:creator];
  }
  return self;
}

- (void)addOrUpdateItemWithBSBserObject:(BSBserObject<DKListEngineItem> *)item {
  @synchronized(LOCK_) {
    [((DKObjectCache *) nil_chk(cache_)) onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<DKListEngineItem> *) nil_chk(item)) getEngineId]) withId:item];
    id<JavaUtilList> items = [[JavaUtilArrayList alloc] init];
    [items addWithId:item];
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) addOrUpdateItemsWithJavaUtilList:items];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) addOrUpdateWithId:item];
    }
  }
}

- (void)addOrUpdateItemsWithJavaUtilList:(id<JavaUtilList>)items {
  @synchronized(LOCK_) {
    for (BSBserObject<DKListEngineItem> * __strong i in nil_chk(items)) {
      [((DKObjectCache *) nil_chk(cache_)) onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<DKListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) addOrUpdateItemsWithJavaUtilList:items];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) addOrUpdateWithJavaUtilList:items];
    }
  }
}

- (void)replaceItemsWithJavaUtilList:(id<JavaUtilList>)items {
  @synchronized(LOCK_) {
    [((DKObjectCache *) nil_chk(cache_)) clear];
    for (BSBserObject<DKListEngineItem> * __strong i in nil_chk(items)) {
      [cache_ onObjectUpdatedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<DKListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) replaceItemsWithJavaUtilList:items];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) onItemsReplacedWithJavaUtilList:items];
    }
  }
}

- (void)removeItemWithLong:(jlong)key {
  @synchronized(LOCK_) {
    [((DKObjectCache *) nil_chk(cache_)) removeObjectWithId:JavaLangLong_valueOfWithLong_(key)];
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) removeWithLongArray:[IOSLongArray newArrayWithLongs:(jlong[]){ key } count:1]];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) onItemRemovedWithLong:key];
    }
  }
}

- (void)removeItemsWithLongArray:(IOSLongArray *)keys {
  @synchronized(LOCK_) {
    {
      IOSLongArray *a__ = keys;
      jlong const *b__ = ((IOSLongArray *) nil_chk(a__))->buffer_;
      jlong const *e__ = b__ + a__->size_;
      while (b__ < e__) {
        jlong key = *b__++;
        [((DKObjectCache *) nil_chk(cache_)) removeObjectWithId:JavaLangLong_valueOfWithLong_(key)];
      }
    }
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) removeWithLongArray:keys];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) onItemsRemovedWithLongArray:keys];
    }
  }
}

- (void)clear {
  @synchronized(LOCK_) {
    [((DKObjectCache *) nil_chk(cache_)) clear];
    [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) clear];
    for (id<DKListEngineDisplayListener> __strong l in nil_chk(listeners_)) {
      [((id<DKListEngineDisplayListener>) nil_chk(l)) onListClear];
    }
  }
}

- (id)getValueWithLong:(jlong)key {
  @synchronized(LOCK_) {
    BSBserObject<DKListEngineItem> *res = [((DKObjectCache *) nil_chk(cache_)) lookupWithId:JavaLangLong_valueOfWithLong_(key)];
    if (res != nil) {
      return res;
    }
  }
  BSBserObject<DKListEngineItem> *res = [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) getValueWithLong:key];
  if (res != nil) {
    @synchronized(LOCK_) {
      [cache_ onObjectLoadedWithId:JavaLangLong_valueOfWithLong_(key) withId:res];
    }
  }
  return res;
}

- (id)getHeadValue {
  BSBserObject<DKListEngineItem> *res = [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) getHeadValue];
  if (res != nil) {
    @synchronized(LOCK_) {
      [((DKObjectCache *) nil_chk(cache_)) onObjectLoadedWithId:JavaLangLong_valueOfWithLong_([res getEngineId]) withId:res];
    }
  }
  return res;
}

- (jboolean)isEmpty {
  return [self getCount] > 0;
}

- (jint)getCount {
  return [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) getCount];
}

- (void)subscribeWithDKListEngineDisplayListener:(id<DKListEngineDisplayListener>)listener {
  if (![((JavaUtilConcurrentCopyOnWriteArrayList *) nil_chk(listeners_)) containsWithId:listener]) {
    [listeners_ addWithId:listener];
  }
}

- (void)unsubscribeWithDKListEngineDisplayListener:(id<DKListEngineDisplayListener>)listener {
  [((JavaUtilConcurrentCopyOnWriteArrayList *) nil_chk(listeners_)) removeWithId:listener];
}

- (void)loadForwardWithInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:nil withJavaLangLong:nil withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadForwardWithLong:(jlong)afterSortKey
                    withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:nil withJavaLangLong:JavaLangLong_valueOfWithLong_(afterSortKey) withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadForwardWithNSString:(NSString *)query
                        withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:query withJavaLangLong:nil withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadForwardWithNSString:(NSString *)query
                       withLong:(jlong)afterSortKey
                        withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadForwardWithNSString:query withJavaLangLong:JavaLangLong_valueOfWithLong_(afterSortKey) withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadBackwardWithInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:nil withJavaLangLong:nil withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadBackwardWithLong:(jlong)beforeSortKey
                     withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:nil withJavaLangLong:JavaLangLong_valueOfWithLong_(beforeSortKey) withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadBackwardWithNSString:(NSString *)query
                         withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:query withJavaLangLong:nil withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadBackwardWithNSString:(NSString *)query
                        withLong:(jlong)beforeSortKey
                         withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadBackwardWithNSString:query withJavaLangLong:JavaLangLong_valueOfWithLong_(beforeSortKey) withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (void)loadCenterWithLong:(jlong)centerSortKey
                   withInt:(jint)limit
withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  [((DKAsyncStorageInt *) nil_chk(asyncStorageInt_)) loadCenterWithLong:centerSortKey withInt:limit withDKListEngineDisplayLoadCallback:DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback)];
}

- (id<DKListEngineDisplayLoadCallback>)coverWithDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)callback {
  return DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(self, callback);
}

- (void)copyAllFieldsTo:(DKAsyncListEngine *)other {
  [super copyAllFieldsTo:other];
  other->asyncStorageInt_ = asyncStorageInt_;
  other->cache_ = cache_;
  other->LOCK_ = LOCK_;
  other->listeners_ = listeners_;
}

@end

id<DKListEngineDisplayLoadCallback> DKAsyncListEngine_coverWithDKListEngineDisplayLoadCallback_(DKAsyncListEngine *self, id<DKListEngineDisplayLoadCallback> callback) {
  return [[DKAsyncListEngine_$1 alloc] initWithDKAsyncListEngine:self withDKListEngineDisplayLoadCallback:callback];
}

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(DKAsyncListEngine)

@implementation DKAsyncListEngine_$1

- (void)onLoadedWithJavaUtilList:(id<JavaUtilList>)items
                        withLong:(jlong)topSortKey
                        withLong:(jlong)bottomSortKey {
  @synchronized(this$0_->LOCK_) {
    for (BSBserObject<DKListEngineItem> * __strong i in nil_chk(items)) {
      [((DKObjectCache *) nil_chk(this$0_->cache_)) onObjectLoadedWithId:JavaLangLong_valueOfWithLong_([((BSBserObject<DKListEngineItem> *) nil_chk(i)) getEngineId]) withId:i];
    }
  }
  [((id<DKListEngineDisplayLoadCallback>) nil_chk(val$callback_)) onLoadedWithJavaUtilList:items withLong:topSortKey withLong:bottomSortKey];
}

- (instancetype)initWithDKAsyncListEngine:(DKAsyncListEngine *)outer$
      withDKListEngineDisplayLoadCallback:(id<DKListEngineDisplayLoadCallback>)capture$0 {
  this$0_ = outer$;
  val$callback_ = capture$0;
  return [super init];
}

- (void)copyAllFieldsTo:(DKAsyncListEngine_$1 *)other {
  [super copyAllFieldsTo:other];
  other->this$0_ = this$0_;
  other->val$callback_ = val$callback_;
}

@end

J2OBJC_CLASS_TYPE_LITERAL_SOURCE(DKAsyncListEngine_$1)
